{"version":3,"file":"chat-message.jsx","sourceRoot":"","sources":["chat-message.tsx"],"names":[],"mappings":"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","sourcesContent":["\nimport { cn } from \"@/lib/utils\";\nimport type { Message } from \"@/lib/types\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { User, AlertTriangle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport ReactMarkdown from 'react-markdown';\nimport React, { ReactNode } from 'react';\nimport alvinIconBlue from \"@/app/images/alvin-icon-blue.png\";\nimport alvinIconWhite from \"@/app/images/alvin-icon-white.png\";\n\ninterface ChatMessageProps {\n  message: Message;\n  onSuggestionClick?: (suggestion: string) => void;\n  theme?: string;\n}\n\nconst components = {\n  p: ({ children }: { children?: ReactNode }) => {\n    const text = typeof children === 'string' ? children : '';\n    const isExplainPrompt = text.includes('Would you like me to explain this in more detail');\n    \n    if (isExplainPrompt) {\n      return (\n        <div className=\"explain-prompt\">\n          <span style={{ fontSize: '1.1em' }}>ğŸ’¬</span>\n          {children}\n        </div>\n      );\n    }\n    \n    return (\n      <p className=\"markdown-paragraph\">\n        {children}\n      </p>\n    );\n  },\n  strong: ({ children }: { children?: ReactNode }) => (\n    <strong className=\"markdown-strong text-blue-600 font-semibold\">\n      {children}\n    </strong>\n  ),\n  ul: ({ children }: { children?: ReactNode }) => {\n    return (\n      <ul className=\"space-y-2 my-3 list-none pl-0\">\n        {children}\n      </ul>\n    );\n  },\n  li: ({ children }: { children?: ReactNode }) => {\n    return (\n      <li className=\"markdown-list-item flex items-start gap-2\">\n        <span className=\"markdown-checkmark text-green-600 dark:text-green-400 font-bold mt-0.5 flex-shrink-0\">âœ“</span>\n        <span className=\"flex-1\">{children}</span>\n      </li>\n    );\n  },\n  ol: ({ children }: { children?: ReactNode }) => (\n    <ol style={{ \n      margin: '0.6em 0 0.6em 1.2em', \n      listStyle: 'decimal',\n      paddingLeft: '0.3em'\n    }}>\n      {children}\n    </ol>\n  ),\n  h3: ({ children }: { children?: ReactNode }) => (\n    <h3 className=\"markdown-h3\">\n      <span className=\"markdown-icon\">ğŸ“‹</span>\n      {children}\n    </h3>\n  ),\n  h4: ({ children }: { children?: ReactNode }) => (\n    <h4 className=\"markdown-h4\">\n      <span className=\"markdown-icon\">â„¹ï¸</span>\n      {children}\n    </h4>\n  ),\n  blockquote: ({ children }: { children?: ReactNode }) => (\n    <blockquote className=\"markdown-blockquote\">\n      <span className=\"markdown-blockquote-icon\">ğŸ’¡</span>\n      {children}\n    </blockquote>\n  ),\n  table: ({ children }: { children?: ReactNode }) => (\n    <div className=\"overflow-x-auto my-4\">\n      <table className=\"w-full border-collapse border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden\">\n        {children}\n      </table>\n    </div>\n  ),\n  thead: ({ children }: { children?: ReactNode }) => (\n    <thead className=\"bg-gray-100 dark:bg-gray-800\">\n      {children}\n    </thead>\n  ),\n  tbody: ({ children }: { children?: ReactNode }) => (\n    <tbody className=\"bg-white dark:bg-gray-900\">\n      {children}\n    </tbody>\n  ),\n  tr: ({ children }: { children?: ReactNode }) => (\n    <tr className=\"border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800\">\n      {children}\n    </tr>\n  ),\n  th: ({ children }: { children?: ReactNode }) => (\n    <th className=\"px-4 py-3 text-left font-semibold text-gray-900 dark:text-gray-100 border-r border-gray-200 dark:border-gray-700\">\n      {children}\n    </th>\n  ),\n  td: ({ children }: { children?: ReactNode }) => (\n    <td className=\"px-4 py-3 text-gray-700 dark:text-gray-300 border-r border-gray-200 dark:border-gray-700\">\n      {children}\n    </td>\n  ),\n};\n\nfunction cleanMarkdown(text: string) {\n  // Replace 3+ newlines with just 2\n  return text.replace(/\\n{3,}/g, '\\n\\n');\n}\n\nexport function ChatMessage({ message, onSuggestionClick, theme }: ChatMessageProps) {\n  const isUser = message.role === \"user\";\n  const isSystem = message.role === \"system\";\n\n  return (\n    <div\n      className={cn(\n        \"flex items-start gap-3 animate-in fade-in duration-300\",\n        isUser ? \"justify-end\" : \"justify-start\"\n      )}\n    >\n      {!isUser && (\n        <Avatar className=\"h-8 w-8 border\">\n          <AvatarFallback className=\"bg-card\">\n            {isSystem ? (\n              <AlertTriangle className=\"h-5 w-5 text-amber-500\" />\n            ) : (\n              <img \n                src={theme === \"dark\" ? alvinIconWhite.src : alvinIconBlue.src} \n                alt=\"Alvin Bot\" \n                className=\"h-5 w-5 object-contain\"\n              />\n            )}\n          </AvatarFallback>\n        </Avatar>\n      )}\n      <div className=\"flex flex-col gap-2\">\n        <div\n          className={cn(\n            \"max-w-2xl rounded-lg px-6 py-5 text-sm shadow-sm relative overflow-x-auto max-w-full break-words\",\n            isUser\n              ? \"chat-message-user\"\n              : isSystem\n              ? \"bg-amber-50 border border-amber-200 text-amber-900 dark:bg-amber-950 dark:border-amber-800 dark:text-amber-200\"\n              : \"chat-message-ai\",\n            isSystem && \"w-full text-left\"\n          )}\n        >\n          <div \n            className={cn(\n              \"markdown-content formal-answer prose prose-sm max-w-none break-words overflow-x-auto\",\n              isUser && \"prose-invert [&_*]:!text-white [&_p]:!text-white [&_strong]:!text-white [&_em]:!text-white [&_li]:!text-white [&_.markdown-paragraph]:!text-white [&_.markdown-strong]:!text-white [&_.markdown-list-item]:!text-white [&_*]:!text-white\"\n            )}\n            style={isUser ? { color: 'white !important' } : undefined}\n          >\n            <ReactMarkdown\n              children={cleanMarkdown(message.content)}\n              allowedElements={['p', 'strong', 'em', 'ul', 'ol', 'li', 'br', 'h3', 'h4', 'blockquote', 'table', 'thead', 'tbody', 'tr', 'th', 'td']}\n              components={components}\n            />\n          </div>\n        </div>\n        {message.suggestions && message.suggestions.length > 0 && (\n          <div className=\"flex flex-wrap gap-2\">\n            {message.suggestions.map((suggestion, index) => (\n              <Button\n                key={index}\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => onSuggestionClick?.(suggestion)}\n                className=\"text-xs hover:bg-blue-50 hover:border-blue-300 hover:text-blue-700 dark:hover:bg-blue-950 dark:hover:border-blue-600 dark:hover:text-blue-300\"\n              >\n                {suggestion}\n              </Button>\n            ))}\n          </div>\n        )}\n      </div>\n      {isUser && (\n        <div className=\"group relative\">\n          <Avatar className=\"h-8 w-8 border-2 border-white shadow-md transition-all duration-200 group-hover:scale-110 group-hover:shadow-lg\">\n            <AvatarFallback className=\"bg-white text-blue-600 font-semibold\">\n              <User className=\"h-5 w-5\" />\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap\">\n            You\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"]}